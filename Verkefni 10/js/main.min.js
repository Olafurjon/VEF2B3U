function logstod(e,o,t,n,s,a){this.name=e,this.company=o,this.bensin=t,this.diesel=n,this.geox=s,this.geoy=a}function initMap(){console.log("mapinit");var e=new google.maps.Map(document.getElementById("map"),{zoom:8}),o=new google.maps.Geocoder;o.geocode({address:"Iceland"},function(o,t){"OK"===t?e.setCenter(o[0].geometry.location):window.alert("Geocode was not successful for the following reason: "+t)});var t=new google.maps.InfoWindow({map:e});navigator.geolocation?navigator.geolocation.getCurrentPosition(function(n){function s(e){for(var o=0;o<e.length;o++)e[o].setMap(null);e=[]}var a={lat:n.coords.latitude,lng:n.coords.longitude};me=a;for(var r=new google.maps.LatLngBounds,l=[],i=0,g=0;10>g;){var d={name:arraystodvar[g+10].name,lat:arraystodvar[g+10].geox,lng:arraystodvar[g+10].geoy},c=new google.maps.DistanceMatrixService;c.getDistanceMatrix({origins:[me],destinations:[d],travelMode:"DRIVING",unitSystem:google.maps.UnitSystem.METRIC,avoidHighways:!1,avoidTolls:!1},function(t,n){if(console.log(t.rows[0].elements[0].distance.value),t.rows[0].elements[0].distance.value>8e3){m--,destarray.pop();var a="nope"}if("OK"!==n&&alert("Error was: "+n),"nope"==a);else{console.log(t),destarray.push(d);var i=t.originAddresses;console.log(t.rows.elements);var g=t.destinationAddresses,c=document.getElementById("output");c.innerHTML+="",s(l);for(var u=function(o){return function(o,t){"OK"===t?e.fitBounds(r.extend(o[0].geometry.location)):alert("Geocode was not successful due to: "+t)}},m=0;m<i.length;m++){var p=t.rows[m].elements;o.geocode({address:i[m]},u(!1));for(var v=0;v<p.length;v++)o.geocode({address:g[v]},u(!1)),c.innerHTML+=i[m]+" to "+g[v]+": "+p[v].distance.text+" in "+p[v].duration.text+"<br>"}}}),g++,i++;var u=d.lat,m=d.lng,p="img/fillingstation.png";new google.maps.Marker({position:{lat:u,lng:m},map:e,icon:p})}new google.maps.Marker({position:a,map:e,title:"Þú!"});t.setPosition(a),t.setContent("Staðsetning fundin"),e.setCenter(a)},function(){handleLocationError(!0,t,e.getCenter())}):handleLocationError(!1,t,e.getCenter())}function handleLocationError(e,o,t){o.setPosition(t),o.setContent(e?"Error: The Geolocation service failed.":"Error: Your browser doesn't support geolocation.")}var destarray=[],arraystodvar=[],stodvar=[];$.ajax({url:"http://apis.is/petrol",type:"GET",dataType:"json",async:!1,success:function(e){console.log(e);for(var o=0;o<e.results.length-1;o++){t=new logstod(e.results[o].name,e.results[o].company,e.results[o].bensin95,e.results[o].diesel,e.results[o].geo.lat,e.results[o].geo.lon),console.log(e.results[o].company),arraystodvar.push(t);var t={nafn:e.results[o].name,lat:e.results[o].geo.lat,lon:e.results[o].geo.lon};stodvar.push(t)}console.log("ajax")}});var me;